pipeline {
    agent none
    environment {
        HOME = '.'
        appName = "basic-crud-app"
    }
    stages {
        stage('Deploy application') {
            agent {
                docker {
                    label 'docker-agent'
                    image 'hernanku/devops-cli:latest'
                    args '-u root'
                }
            }
            steps {
                echo 'Running ansible deploy playbook'
                sh 'ansible-playbook -i playbooks/inventory.yaml playbooks/app-deploy.yaml'
            }
        }
        stage('Clean Workspace') {
            agent any
            steps {
                echo 'Cleaning workspace'
                cleanWs()
            }
        }
    }
}
